/*
 * Author: Timothy Bourke, NICTA
 */
var utf8 = new Object();
utf8['\\<supseteq>'] = 'âŠ‡';
utf8['\\<KK>'] = 'ğ”';
utf8['\\<up>'] = 'â†‘';
utf8['\\<otimes>'] = 'âŠ—';
utf8['\\<aa>'] = 'ğ”';
utf8['\\<dagger>'] = 'â€ ';
utf8['\\<frown>'] = 'âŒ¢';
utf8['\\<guillemotleft>'] = 'Â«';
utf8['\\<qq>'] = 'ğ”®';
utf8['\\<X>'] = 'ğ’³';
utf8['\\<triangleright>'] = 'â–¹';
utf8['\\<guillemotright>'] = 'Â»';
utf8['\\<nu>'] = 'Î½';
utf8['\\<sim>'] = 'âˆ¼';
utf8['\\<rightharpoondown>'] = 'â‡';
utf8['\\<p>'] = 'ğ—‰';
utf8['\\<Up>'] = 'â‡‘';
utf8['\\<triangleq>'] = 'â‰œ';
utf8['\\<nine>'] = 'ğŸµ';
utf8['\\<preceq>'] = 'â‰¼';
utf8['\\<nabla>'] = 'âˆ‡';
utf8['\\<FF>'] = 'ğ”‰';
utf8['\\<II>'] = 'â„‘';
utf8['\\<VV>'] = 'ğ”™';
utf8['\\<spacespace>'] = 'â£';
utf8['\\<and>'] = 'âˆ§';
utf8['\\<mapsto>'] = 'â†¦';
utf8['\\<ll>'] = 'ğ”©';
utf8['\\<F>'] = 'â„±';
utf8['\\<degree>'] = 'Â°';
utf8['\\<beta>'] = 'Î²';
utf8['\\<Colon>'] = 'âˆ·';
utf8['\\<bool>'] = 'ğ”¹';
utf8['\\<e>'] = 'ğ–¾';
utf8['\\<lozenge>'] = 'â—Š';
utf8['\\<u>'] = 'ğ—';
utf8['\\<sharp>'] = 'â™¯';
utf8['\\<Longleftrightarrow>'] = 'âŸº';
utf8['\\<Otimes>'] = 'â¨‚';
utf8['\\<EE>'] = 'ğ”ˆ';
utf8['\\<I>'] = 'â„';
utf8['\\<UU>'] = 'ğ”˜';
utf8['\\<exclamdown>'] = 'Â¡';
utf8['\\<dots>'] = 'â€¦';
utf8['\\<N>'] = 'ğ’©';
utf8['\\<kk>'] = 'ğ”¨';
utf8['\\<plusminus>'] = 'Â±';
utf8['\\<E>'] = 'â„°';
utf8['\\<triangle>'] = 'â–³';
utf8['\\<eta>'] = 'Î·';
utf8['\\<triangleleft>'] = 'â—ƒ';
utf8['\\<chi>'] = 'Ï‡';
utf8['\\<z>'] = 'ğ—“';
utf8['\\<hungarumlaut>'] = 'Ë';
utf8['\\<partial>'] = 'âˆ‚';
utf8['\\<three>'] = 'ğŸ¯';
utf8['\\<lesssim>'] = 'â‰²';
utf8['\\<subset>'] = 'âŠ‚';
utf8['\\<H>'] = 'â„‹';
utf8['\\<leftarrow>'] = 'â†';
utf8['\\<PP>'] = 'ğ”“';
utf8['\\<sqsupseteq>'] = 'âŠ’';
utf8['\\<R>'] = 'â„›';
utf8['\\<bowtie>'] = 'â¨';
utf8['\\<C>'] = 'ğ’';
utf8['\\<ddagger>'] = 'â€¡';
utf8['\\<ff>'] = 'ğ”£';
utf8['\\<turnstile>'] = 'âŠ¢';
utf8['\\<bar>'] = 'Â¦';
utf8['\\<propto>'] = 'âˆ';
utf8['\\<S>'] = 'ğ’®';
utf8['\\<vv>'] = 'ğ”³';
utf8['\\<lhd>'] = 'âŠ²';
utf8['\\<paragraph>'] = 'Â¶';
utf8['\\<mu>'] = 'Î¼';
utf8['\\<rightharpoonup>'] = 'â‡€';
utf8['\\<Inter>'] = 'â‹‚';
utf8['\\<o>'] = 'ğ—ˆ';
utf8['\\<asymp>'] = 'â‰';
utf8['\\<Leftarrow>'] = 'â‡';
utf8['\\<Sqinter>'] = 'â¨…';
utf8['\\<eight>'] = 'ğŸ´';
utf8['\\<succeq>'] = 'â‰½';
utf8['\\<forall>'] = 'âˆ€';
utf8['\\<complex>'] = 'â„‚';
utf8['\\<GG>'] = 'ğ”Š';
utf8['\\<Coprod>'] = 'âˆ';
utf8['\\<L>'] = 'â„’';
utf8['\\<WW>'] = 'ğ”š';
utf8['\\<leadsto>'] = 'â†';
utf8['\\<D>'] = 'ğ’Ÿ';
utf8['\\<angle>'] = 'âˆ ';
utf8['\\<section>'] = 'Â§';
utf8['\\<TTurnstile>'] = 'âŠ«';
utf8['\\<mm>'] = 'ğ”ª';
utf8['\\<T>'] = 'ğ’¯';
utf8['\\<alpha>'] = 'Î±';
utf8['\\<leftharpoondown>'] = 'â†½';
utf8['\\<rho>'] = 'Ï';
utf8['\\<wrong>'] = 'â‰€';
utf8['\\<l>'] = 'ğ—…';
utf8['\\<doteq>'] = 'â‰';
utf8['\\<times>'] = 'Ã—';
utf8['\\<noteq>'] = 'â‰ ';
utf8['\\<rangle>'] = 'âŸ©';
utf8['\\<div>'] = 'Ã·';
utf8['\\<Longrightarrow>'] = 'âŸ¹';
utf8['\\<BB>'] = 'ğ”…';
utf8['\\<sqsupset>'] = 'âŠ';
utf8['\\<rightarrow>'] = 'â†’';
utf8['\\<real>'] = 'â„';
utf8['\\<hh>'] = 'ğ”¥';
utf8['\\<Phi>'] = 'Î¦';
utf8['\\<integral>'] = 'âˆ«';
utf8['\\<CC>'] = 'â„­';
utf8['\\<euro>'] = 'â‚¬';
utf8['\\<xx>'] = 'ğ”µ';
utf8['\\<Y>'] = 'ğ’´';
utf8['\\<zeta>'] = 'Î¶';
utf8['\\<longleftarrow>'] = 'âŸµ';
utf8['\\<a>'] = 'ğ–º';
utf8['\\<onequarter>'] = 'Â¼';
utf8['\\<And>'] = 'â‹€';
utf8['\\<downharpoonright>'] = 'â‡‚';
utf8['\\<phi>'] = 'Ï†';
utf8['\\<q>'] = 'ğ—Š';
utf8['\\<Rightarrow>'] = 'â‡’';
utf8['\\<clubsuit>'] = 'â™£';
utf8['\\<ggreater>'] = 'â‰«';
utf8['\\<two>'] = 'ğŸ®';
utf8['\\<succ>'] = 'â‰»';
utf8['\\<AA>'] = 'ğ”„';
utf8['\\<lparr>'] = 'â¦‡';
utf8['\\<Squnion>'] = 'â¨†';
utf8['\\<HH>'] = 'â„Œ';
utf8['\\<sqsubseteq>'] = 'âŠ‘';
utf8['\\<QQ>'] = 'ğ””';
utf8['\\<setminus>'] = 'âˆ–';
utf8['\\<Lambda>'] = 'Î›';
utf8['\\<RR>'] = 'â„œ';
utf8['\\<J>'] = 'ğ’¥';
utf8['\\<gg>'] = 'ğ”¤';
utf8['\\<hyphen>'] = 'Â­';
utf8['\\<B>'] = 'â„¬';
utf8['\\<Z>'] = 'ğ’µ';
utf8['\\<ww>'] = 'ğ”´';
utf8['\\<lambda>'] = 'Î»';
utf8['\\<onehalf>'] = 'Â½';
utf8['\\<f>'] = 'ğ–¿';
utf8['\\<Or>'] = 'â‹';
utf8['\\<v>'] = 'ğ—';
utf8['\\<natural>'] = 'â™®';
utf8['\\<seven>'] = 'ğŸ³';
utf8['\\<Oplus>'] = 'â¨';
utf8['\\<subseteq>'] = 'âŠ†';
utf8['\\<rfloor>'] = 'âŒ‹';
utf8['\\<LL>'] = 'ğ”';
utf8['\\<Sum>'] = 'âˆ‘';
utf8['\\<ominus>'] = 'âŠ–';
utf8['\\<bb>'] = 'ğ”Ÿ';
utf8['\\<Pi>'] = 'Î ';
utf8['\\<cent>'] = 'Â¢';
utf8['\\<diamond>'] = 'â—‡';
utf8['\\<mho>'] = 'â„§';
utf8['\\<O>'] = 'ğ’ª';
utf8['\\<rr>'] = 'ğ”¯';
utf8['\\<twosuperior>'] = 'Â²';
utf8['\\<leftharpoonup>'] = 'â†¼';
utf8['\\<pi>'] = 'Ï€';
utf8['\\<k>'] = 'ğ—„';
utf8['\\<star>'] = 'â‹†';
utf8['\\<rightleftharpoons>'] = 'â‡Œ';
utf8['\\<equiv>'] = 'â‰¡';
utf8['\\<langle>'] = 'âŸ¨';
utf8['\\<Longleftarrow>'] = 'âŸ¸';
utf8['\\<nexists>'] = 'âˆ„';
utf8['\\<Odot>'] = 'â¨€';
utf8['\\<lfloor>'] = 'âŒŠ';
utf8['\\<sqsubset>'] = 'âŠ';
utf8['\\<SS>'] = 'ğ”–';
utf8['\\<box>'] = 'â–¡';
utf8['\\<index>'] = 'Ä±';
utf8['\\<pounds>'] = 'Â£';
utf8['\\<Upsilon>'] = 'Î¥';
utf8['\\<ii>'] = 'ğ”¦';
utf8['\\<hookleftarrow>'] = 'â†©';
utf8['\\<P>'] = 'ğ’«';
utf8['\\<threesuperior>'] = 'Â³';
utf8['\\<epsilon>'] = 'Îµ';
utf8['\\<yy>'] = 'ğ”¶';
utf8['\\<h>'] = 'ğ—';
utf8['\\<upsilon>'] = 'Ï…';
utf8['\\<x>'] = 'ğ—‘';
utf8['\\<not>'] = 'Â¬';
utf8['\\<le>'] = 'â‰¤';
utf8['\\<one>'] = 'ğŸ­';
utf8['\\<cdots>'] = 'â‹¯';
utf8['\\<some>'] = 'Ïµ';
utf8['\\<Prod>'] = 'âˆ';
utf8['\\<NN>'] = 'ğ”‘';
utf8['\\<squnion>'] = 'âŠ”';
utf8['\\<dd>'] = 'ğ”¡';
utf8['\\<top>'] = 'âŠ¤';
utf8['\\<dieresis>'] = 'Â¨';
utf8['\\<tt>'] = 'ğ”±';
utf8['\\<U>'] = 'ğ’°';
utf8['\\<unlhd>'] = 'âŠ´';
utf8['\\<cedilla>'] = 'Â¸';
utf8['\\<kappa>'] = 'Îº';
utf8['\\<amalg>'] = 'â¨¿';
utf8['\\<restriction>'] = 'â†¾';
utf8['\\<struct>'] = 'â‹„';
utf8['\\<m>'] = 'ğ—†';
utf8['\\<six>'] = 'ğŸ²';
utf8['\\<midarrow>'] = 'â”€';
utf8['\\<lbrace>'] = 'â¦ƒ';
utf8['\\<lessapprox>'] = 'âª…';
utf8['\\<MM>'] = 'ğ”';
utf8['\\<down>'] = 'â†“';
utf8['\\<oplus>'] = 'âŠ•';
utf8['\\<wp>'] = 'â„˜';
utf8['\\<surd>'] = 'âˆš';
utf8['\\<cc>'] = 'ğ” ';
utf8['\\<bottom>'] = 'âŠ¥';
utf8['\\<copyright>'] = 'Â©';
utf8['\\<ZZ>'] = 'â„¨';
utf8['\\<union>'] = 'âˆª';
utf8['\\<V>'] = 'ğ’±';
utf8['\\<ss>'] = 'ğ”°';
utf8['\\<unrhd>'] = 'âŠµ';
utf8['\\<onesuperior>'] = 'Â¹';
utf8['\\<b>'] = 'ğ–»';
utf8['\\<downharpoonleft>'] = 'â‡ƒ';
utf8['\\<cdot>'] = 'â‹…';
utf8['\\<r>'] = 'ğ—‹';
utf8['\\<Midarrow>'] = 'â•';
utf8['\\<Down>'] = 'â‡“';
utf8['\\<diamondsuit>'] = 'â™¢';
utf8['\\<rbrakk>'] = 'âŸ§';
utf8['\\<lless>'] = 'â‰ª';
utf8['\\<longleftrightarrow>'] = 'âŸ·';
utf8['\\<prec>'] = 'â‰º';
utf8['\\<emptyset>'] = 'âˆ…';
utf8['\\<rparr>'] = 'â¦ˆ';
utf8['\\<Delta>'] = 'Î”';
utf8['\\<XX>'] = 'ğ”›';
utf8['\\<parallel>'] = 'âˆ¥';
utf8['\\<K>'] = 'ğ’¦';
utf8['\\<nn>'] = 'ğ”«';
utf8['\\<registered>'] = 'Â®';
utf8['\\<M>'] = 'â„³';
utf8['\\<delta>'] = 'Î´';
utf8['\\<threequarters>'] = 'Â¾';
utf8['\\<g>'] = 'ğ—€';
utf8['\\<cong>'] = 'â‰…';
utf8['\\<tau>'] = 'Ï„';
utf8['\\<w>'] = 'ğ—';
utf8['\\<ge>'] = 'â‰¥';
utf8['\\<flat>'] = 'â™­';
utf8['\\<zero>'] = 'ğŸ¬';
utf8['\\<Uplus>'] = 'â¨„';
utf8['\\<longmapsto>'] = 'âŸ¼';
utf8['\\<supset>'] = 'âŠƒ';
utf8['\\<in>'] = 'âˆˆ';
utf8['\\<sqinter>'] = 'âŠ“';
utf8['\\<OO>'] = 'ğ”’';
utf8['\\<updown>'] = 'â†•';
utf8['\\<circ>'] = 'âˆ˜';
utf8['\\<rat>'] = 'â„š';
utf8['\\<stileturn>'] = 'âŠ£';
utf8['\\<ee>'] = 'ğ”¢';
utf8['\\<Omega>'] = 'Î©';
utf8['\\<or>'] = 'âˆ¨';
utf8['\\<inverse>'] = 'Â¯';
utf8['\\<rhd>'] = 'âŠ³';
utf8['\\<uu>'] = 'ğ”²';
utf8['\\<iota>'] = 'Î¹';
utf8['\\<d>'] = 'ğ–½';
utf8['\\<questiondown>'] = 'Â¿';
utf8['\\<Union>'] = 'â‹ƒ';
utf8['\\<omega>'] = 'Ï‰';
utf8['\\<approx>'] = 'â‰ˆ';
utf8['\\<t>'] = 'ğ—';
utf8['\\<Updown>'] = 'â‡•';
utf8['\\<spadesuit>'] = 'â™ ';
utf8['\\<five>'] = 'ğŸ±';
utf8['\\<exists>'] = 'âˆƒ';
utf8['\\<rceil>'] = 'âŒ‰';
utf8['\\<JJ>'] = 'ğ”';
utf8['\\<minusplus>'] = 'âˆ“';
utf8['\\<nat>'] = 'â„•';
utf8['\\<oslash>'] = 'âŠ˜';
utf8['\\<A>'] = 'ğ’œ';
utf8['\\<Xi>'] = 'Î';
utf8['\\<currency>'] = 'Â¤';
utf8['\\<Turnstile>'] = 'âŠ¨';
utf8['\\<hookrightarrow>'] = 'â†ª';
utf8['\\<pp>'] = 'ğ”­';
utf8['\\<Q>'] = 'ğ’¬';
utf8['\\<aleph>'] = 'â„µ';
utf8['\\<acute>'] = 'Â´';
utf8['\\<xi>'] = 'Î¾';
utf8['\\<simeq>'] = 'â‰ƒ';
utf8['\\<i>'] = 'ğ—‚';
utf8['\\<Join>'] = 'â‹ˆ';
utf8['\\<y>'] = 'ğ—’';
utf8['\\<lbrakk>'] = 'âŸ¦';
utf8['\\<greatersim>'] = 'â‰³';
utf8['\\<greaterapprox>'] = 'âª†';
utf8['\\<longrightarrow>'] = 'âŸ¶';
utf8['\\<lceil>'] = 'âŒˆ';
utf8['\\<Gamma>'] = 'Î“';
utf8['\\<odot>'] = 'âŠ™';
utf8['\\<YY>'] = 'ğ”œ';
utf8['\\<infinity>'] = 'âˆ';
utf8['\\<Sigma>'] = 'Î£';
utf8['\\<yen>'] = 'Â¥';
utf8['\\<int>'] = 'â„¤';
utf8['\\<tturnstile>'] = 'âŠ©';
utf8['\\<oo>'] = 'ğ”¬';
utf8['\\<ointegral>'] = 'âˆ®';
utf8['\\<gamma>'] = 'Î³';
utf8['\\<upharpoonleft>'] = 'â†¿';
utf8['\\<sigma>'] = 'Ïƒ';
utf8['\\<n>'] = 'ğ—‡';
utf8['\\<rbrace>'] = 'â¦„';
utf8['\\<DD>'] = 'ğ”‡';
utf8['\\<notin>'] = 'âˆ‰';
utf8['\\<j>'] = 'ğ—ƒ';
utf8['\\<uplus>'] = 'âŠ';
utf8['\\<leftrightarrow>'] = 'â†”';
utf8['\\<TT>'] = 'ğ”—';
utf8['\\<bullet>'] = 'âˆ™';
utf8['\\<Theta>'] = 'Î˜';
utf8['\\<smile>'] = 'âŒ£';
utf8['\\<G>'] = 'ğ’¢';
utf8['\\<jj>'] = 'ğ”§';
utf8['\\<inter>'] = 'âˆ©';
utf8['\\<Psi>'] = 'Î¨';
utf8['\\<ordfeminine>'] = 'Âª';
utf8['\\<W>'] = 'ğ’²';
utf8['\\<zz>'] = 'ğ”·';
utf8['\\<theta>'] = 'Î¸';
utf8['\\<ordmasculine>'] = 'Âº';
utf8['\\<c>'] = 'ğ–¼';
utf8['\\<psi>'] = 'Ïˆ';
utf8['\\<s>'] = 'ğ—Œ';
utf8['\\<Leftrightarrow>'] = 'â‡”';
utf8['\\<heartsuit>'] = 'â™¡';
utf8['\\<four>'] = 'ğŸ°';

var re_xsymbol = /\\<.*?>/g;

function encodequery(ele) {
  var text = ele.value;
  var otext = text;
  var pos = getCaret(ele);

  xsymbols = text.match(re_xsymbol);
  for (i in xsymbols) {
    var repl = utf8[xsymbols[i]];
    if (repl) {
	text = text.replace(xsymbols[i], repl, "g");
    }
  }

  if (text != otext) {
    ele.value = text;

    if (pos != -1) {
      pos = pos - (otext.length - text.length);
      setCaret(ele, pos);
    }
  }
}

/* from: http://www.webdeveloper.com/forum/showthread.php?t=74982 */
function getCaret(obj) {
  var pos = -1;

  if (document.selection) { // IE
    obj.focus ();
    var sel = document.selection.createRange();
    var sellen = document.selection.createRange().text.length;
    sel.moveStart ('character', -obj.value.length);
    pos = sel.text.length - sellen;

  } else if (obj.selectionStart || obj.selectionStart == '0') { // Gecko
    pos = obj.selectionStart;
  }
  
  return pos;
}

/* from: http://parentnode.org/javascript/working-with-the-cursor-position/ */
function setCaret(obj, pos) {
  if (obj.createTextRange) {
      var range = obj.createTextRange();
      range.move("character", pos);
      range.select();
  } else if (obj.selectionStart) {
      obj.focus();
      obj.setSelectionRange(pos, pos);
  }
}

